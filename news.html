<html>
    <head>
        <title>AND - NEWS</title>
        <link rel="icon" href="/img/logo.png">
        <link href="styles/style.css" rel="stylesheet" type="text/css" />
        <style>
            body { font-family: "Pretendard", sans-serif; margin: 40px; background: #f8f8f8; }
            h1 { text-align: center; }
            .board { max-width: 600px; margin: auto; }
            input, textarea { width: 100%; margin: 5px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
            button { padding: 10px 15px; background: #333; color: white; border: none; border-radius: 5px; cursor: pointer; }
            button:hover { background: #555; }
            .post { background: white; padding: 15px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
            .post h3 { margin: 0 0 5px 0; }
            .post small { color: gray; }
        </style>
    </head>
    <body>
        <div style="height: 5000px; overflow-y: scroll;">
            <div class="UB2">
                <a href="https://nameless-hoshi.github.io/NEUTRONDIVISION.io/">
                <img src="img/logo.png" title="home" style="width:150px; height:150px;">
                </a>
            </div>
            <ul class="UB1">
                <li><a href="https://nameless-hoshi.github.io/NEUTRONDIVISION.io/info" title="what about us">INFO</a></li>
                <li><a href="https://nameless-hoshi.github.io/NEUTRONDIVISION.io/philosophy" title="our philosophy">OUR PHILOSOPHY</a></li>
                <li><a href="https://nameless-hoshi.github.io/NEUTRONDIVISION.io/news" title="news">NEWS</a></li>
                <li><a href="https://nameless-hoshi.github.io/NEUTRONDIVISION.io/creation" title="creation">CREATION</a></li>
                <li><a href="https://nameless-hoshi.github.io/NEUTRONDIVISION.io/hero" title="hero">HERO</a></li>
            </ul>
            </div>
        </div>



        <div class="wrap">
            <h1>댓글</h1>
            <div id="status" class="err"></div>
            <input id="title" placeholder="아이디" />
            <textarea id="content" rows="6" placeholder="내용"></textarea>
            <button id="postBtn">글 쓰기</button>
            <hr/>
            <div id="posts"></div>
        </div>

          <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, deleteDoc, doc } 
    from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    // Import the functions you need from the SDKs you need
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
    apiKey: "AIzaSyAisg8efEgG-n63thSqWtvW2d2lqUEe7Dw",
    authDomain: "neutrondivision.firebaseapp.com",
    projectId: "neutrondivision",
    storageBucket: "neutrondivision.firebasestorage.app",
    messagingSenderId: "679702672783",
    appId: "1:679702672783:web:714b0e3775d3e1083fc7fa"
    };

    // Initialize Firebase

    // init
async function loadPosts() {
  try {
    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
    const snap = await getDocs(q);
    const postsDiv = document.getElementById("posts");
    postsDiv.innerHTML = ""; // 초기화

    snap.forEach(docSnap => {
      const p = docSnap.data();
      const id = docSnap.id;

      // DOM 요소 생성 (문자열 조합 대신)
      const postEl = document.createElement('div');
      postEl.className = 'post';

      const titleEl = document.createElement('h3');
      titleEl.innerText = p.title || '(제목 없음)';
      postEl.appendChild(titleEl);

      const contentEl = document.createElement('p');
      contentEl.innerHTML = (escapeHtml(p.content) || '').replace(/\n/g, '<br>');
      postEl.appendChild(contentEl);

      const timeEl = document.createElement('small');
      timeEl.innerText = p.time || (p.createdAt ? new Date(p.createdAt).toLocaleString() : '');
      postEl.appendChild(timeEl);

      // 삭제 버튼 (이벤트 리스너 방식)
      const delBtn = document.createElement('button');
      delBtn.innerText = '삭제';
      delBtn.className = 'deleteBtn';
      delBtn.addEventListener('click', async () => {
        if (!confirm('정말 이 글을 삭제하시겠습니까?')) return;
        try {
          await deleteDoc(doc(db, 'posts', id));
          // 삭제 성공 시 UI 갱신
          loadPosts();
        } catch (err) {
          console.error('delete error', err);
          alert('삭제 실패: ' + (err.message || err));
        }
      });
      postEl.appendChild(delBtn);

      postsDiv.appendChild(postEl);
    });
  } catch (e) {
    console.error('loadPosts error', e);
    document.getElementById('status') && (document.getElementById('status').textContent = '글 불러오기 실패: ' + (e.message || e));
  }
}

// XSS 대비 간단 escape
function escapeHtml(str) {
  return String(str || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
//danke chat gpt
  </script>
        
    </body>
</html>